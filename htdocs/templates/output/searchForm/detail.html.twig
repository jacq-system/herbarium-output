{% extends 'output/main.html.twig' %}

{% block main %}
    <div class="container-fluid">
        <div class="row">
            <div class="col s12 m10 l8 offset-l1 condensed">
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Stable identifiers</h6>
                    </div>
                    <div class="col s12 m9"><h6>
                            {% set stableIdentifiers = specimen.getVisibleStableIdentifiers() %}
                            {% if stableIdentifiers|length > 1 %}
                                {% for pid in stableIdentifiers %}
                                    <b><a href="{{ pid.identifier }}" target="_blank">{{ pid.identifier }}</a></b>
                                    ({{ pid.createdAt|date('d-m-Y') }})<br>
                                {% endfor %}
                            {% elseif stableIdentifiers|length == 1 %}
                                {% for pid in stableIdentifiers %}
                                    <b><a href="{{ pid.identifier }}" target="_blank">{{ pid.identifier }}</a></b>
                                {% endfor %}
                            {% else %}
                                {{ constructStableIdentifier(specimen) }}
                            {% endif %}
                        </h6>
                        {% if specimen.pidDissco is not empty %}
                            <p><img loading="lazy" src="{{ asset('logo/institutions/dissco-logo.png') }}" height="20" alt="DiSSCO Logo"> <a href="{{specimen.pidDissco}}">{{specimen.pidDissco}}</a></p>
                        {% endif %}
                        {% if specimen.pidGbif is not empty %}
                            <p><img loading="lazy" src="{{ asset('logo/institutions/GBIF-2015-dotorg-stacked.png') }}" height="20" alt="GBIF Logo"> <a href="{{specimen.pidGbif}}">{{specimen.pidGbif}}</a></p>
                        {% endif %}
                    </div>
                </div>
                <div class="row hide" id="dynamic-references" data-pid="{{ pid }}">
                    <div class="col s12 m3">
                        <h6>Related records</h6>
                    </div>
                    <div class="col s12 m9"><h6><span id="dynamic-ggbn"></span></h6></div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Herbarium #</h6>
                    </div>
                    <div class="col s12 m9"><h6>{{ specimen | herbariumNr | raw }}</h6></div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Collection #</h6>
                    </div>
                    <div class="col s12 m9">
                        <h6>{{ specimen.herbCollection.name }} {{ specimen.collectionNumber }}</h6>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Stored under taxon name</h6>
                    </div>
                    <div class="col s12 m9"><p><b></b></p>
                        <h6><b>{{ specimen.species | taxonName | raw }}</b></h6>

                        <a href="http://www.tropicos.org/NameSearch.aspx?name={{ specimen.species.genus.name }} {{ specimen.species.epithetSpecies is not null ? specimen.species.epithetSpecies.name }}&exact=true"
                           title="Search in tropicos" target="_blank">
                            <img alt="tropicos" src="{{ asset('recordIcons/tropicos.png') }}" width="16"
                                 height="16">
                        </a>
                        {{ specimen.species | taxonAuthority | raw | nl2br }}
                    </div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Family</h6>
                    </div>
                    <div class="col s12 m9"><h6>{{ specimen.species.genus.family.name }}</h6></div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Det./rev./conf./assigned</h6>
                    </div>
                    <div class="col s12 m9"><h6>{{ specimen.determination }}</h6></div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Ident. history</h6>
                    </div>
                    <div class="col s12 m9"><h6>{{ specimen.taxonAlternative }}</h6>
                    </div>
                </div>
                {% for typus in specimen.typus %}
                    <div class="row">
                        <div class="col s12 m3">
                            <h6>{{ typus.rank.latinName }} of </h6>
                        </div>
                        <div class="col s12 m9"><h6>{{ typus.species | taxonName | raw }}</h6>
                            <p>
                                {% for proto in getProtologs(typus.species) %}
                                    {{ proto }}<br>
                                {% endfor %}
                            </p>
                            <p>
                                Typified by: {{ typus.person }} {{ typus.date }}
                            </p>
                        </div>
                    </div>
                {% endfor %}
                {% if specimen.species.isSynonym() %}
                    <div class="row">
                        <div class="col s12 m3">
                            <h6>Current Name</h6>
                        </div>
                        <div class="col s12 m9"><h6>{{ specimen.species.validName | taxonName | raw }}</h6>
                        </div>
                    </div>
                {% endif %}
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Collector</h6>
                    </div>
                    <div class="col s12 m9"><h6>
                            {% include 'output/searchForm/collector_links.html.twig' with { 'specimen': specimen } %}
                            {% include 'output/searchForm/collector_cetaf.html.twig' with { 'collector': specimen.collector } %}
                        </h6>
                    </div>
                </div>
                {% if specimen.hasRelatedSpecimens %}
                    <div class="row" id="specimenLinks"
                         data-source="{{ path('output_specimenLinksD3', {'specimenId': specimen.id }) }}">
                        <div class="col s12 m3">
                            <h6>Linked Specimens and Material</h6>
                        </div>
                        {#                        <div class="col s12 m6" id="linksPlot"></div> #}
                        <div class="col s12 m3">
                            <h6>
                                {% for relatedSpecimen in getRelatedSpecimens(specimen) %}
                                    <p>
                                        <a href='{{ path('output_specimenDetail', {'specimenId': relatedSpecimen['specimen'].id }) }}'>{{ relatedSpecimen['specimen'] | herbariumNr | raw }}</a> {% if relatedSpecimen['relation'] is not empty %}({{ relatedSpecimen['relation'] }}){% endif %}
                                    </p>
                                {% endfor %}
                            </h6>
                        </div>
                    </div>
                {% endif %}
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Date</h6>
                    </div>
                    <div class="col s12 m9">
                        <h6>
                            {{ specimen.date }}
                            {{ specimen.date2 ? ' â€“ ' ~ specimen.date2 : '' }}
                        </h6>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Location</h6>
                    </div>
                    <div class="col s12 m9">
                        {% if specimen.hasCoords() %}
                            <div id="map" style="height: 300px; max-width: 600px"
                                 data-gps="{{ specimen.getCoords() }}"></div>
                        {% endif %}
                        <h6>{{ specimen | localityLong | raw }}</h6></div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Label</h6>
                    </div>
                    <div class="col s12 m9"><h6>{{ specimen.locality | nl2br | raw }}
                            {% if specimen.altitudeMin is not empty %}
                                Alt. {{ specimen.altitudeMin }} m
                                {% if specimen.altitudeMax is not empty %} - {{ specimen.altitudeMax }} m
                                {% endif %}
                            {% endif %}
                        </h6></div>
                </div>
                {% if specimen.localityEng is not null %}
                    <div class="row">
                        <div class="col s12 m3">
                            <h6>Label alternate</h6>
                        </div>
                        <div class="col s12 m9">
                            <h6>
                                {{ specimen.getLocalityEng() | nl2br | raw }}
                            </h6>
                        </div>
                    </div>
                {% endif %}
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Habitat</h6>
                    </div>
                    <div class="col s12 m9"><h6>{{ specimen.habitat | nl2br }}</h6></div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Habitus</h6>
                    </div>
                    <div class="col s12 m9"><h6>{{ specimen.habitus }}</h6></div>
                </div>
                <div class="row">
                    <div class="col s12 m3">
                        <h6>Annotations</h6>
                    </div>
                    <div class="col s12 m9"><h6>{{ specimen | annotation | raw }}</h6></div>
                </div>
            </div>
            <div class="col s12 l8 offset-l1" style='height: 800px'>
                {{ specimen | photoIframe | raw }}
            </div>
        </div>
    </div>
{% endblock %}
